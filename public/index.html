<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVCP Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #DDD;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: transparent;
            overflow: hidden;
        }

        .header {
            color: black;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .api-status {
            padding: 15px;
            background: rgb(255, 255, 255);
            border-radius: 10px;
            font-size: 0.9rem;
            width: 300px;
            margin: 0 auto;
            margin-top: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #4CAF50;
        }

        .status-offline {
            background: #f44336;
        }

        .main-content {
            padding: 40px;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1rem;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #007BFF;
            border-bottom-color: #007BFF;
            font-weight: 600;
        }

        .tab:hover {
            background: #f8f9ff;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upload-area {
            background: #f9f9f9;
            border: 5px dashed #000000;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #005BDD;
            background: #f8f9ff;
        }

        .upload-area.dragover {
            border-color: #005BDD;
            background: #f0f4ff;
        }

        .upload-icon {
            font-size: 3rem;
            color: #005BDD;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e0e6ff;
        }

        .control-group h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007BFF;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-item input[type="radio"] {
            width: auto;
        }

        .switch-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #007BFF;
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .base64-output {
            margin-top: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e6ff;
        }

        .base64-output textarea {
            width: 100%;
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .base64-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .base64-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #6c757d;
            color: white;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .base64-actions button:hover {
            background: #5a6268;
        }

        .base64-preview {
            margin-top: 15px;
        }

        .base64-preview img,
        .base64-preview video {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .process-btn {
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            margin: 20px 0;
            width: 100%;
            height: 51px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            font-weight: bold;
            font-size: 24px;
        }

        .process-btn:hover {
            background-color: #005BDD;
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .process-btn:disabled {
            background-color: rgb(110, 110, 110);
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #000000;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #000;
        }

        .result-container {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 1px solid #e0e6ff;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }

        .result-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .result-status.success {
            background: #d4edda;
            color: #155724;
        }

        .result-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e6ff;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            color: #333;
            font-weight: 600;
        }

        .download-section {
            margin-top: 20px;
        }

        .download-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 14px;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .download-btn:hover {
            background: #218838;
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .parts-list {
            margin-top: 20px;
        }

        .part-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e6ff;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .part-info {
            flex: 1;
        }

        .part-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .part-details {
            font-size: 0.9rem;
            color: #666;
        }

        .quality-change {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #856404;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: 1px solid #e0e6ff;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>IVCP Service</h1>
            <p>ì´ë¯¸ì§€ì™€ ì˜ìƒì„ íš¨ìœ¨ì ìœ¼ë¡œ ì••ì¶•í•˜ê³  ë¶„í• í•©ë‹ˆë‹¤.</p>
            <div class="api-status" id="api-status">
                <span class="status-indicator status-offline"></span>
                <span id="status-text">API ìƒíƒœ í™•ì¸ ì¤‘...</span>
            </div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('image')">ì´ë¯¸ì§€ ì••ì¶•</button>
                <button class="tab" onclick="switchTab('video')">ì˜ìƒ ì••ì¶•/ë¶„í• </button>
                <button class="tab" onclick="switchTab('webm')">WebM ë¶„í• </button>
            </div>

            <!-- ê³µí†µ ì„¤ì • -->
            <div class="controls">
                <div class="control-group">
                    <h3>ê³µí†µ ì„¤ì •</h3>
                    <div class="form-group">
                        <div class="switch-group">
                            <label for="return-base64">Base64 ì¶œë ¥</label>
                            <label class="switch">
                                <input type="checkbox" id="return-base64">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì´ë¯¸ì§€ ì••ì¶• íƒ­ -->
            <div id="image-tab" class="tab-content active">
                <div class="upload-area" onclick="document.getElementById('image-file').click()">
                    <div class="upload-icon">ğŸ“·</div>
                    <div class="upload-text">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">JPG, PNG, WebP, GIF ì§€ì› (ìµœëŒ€ 500MB)</div>
                </div>
                <input type="file" id="image-file" class="file-input" accept="image/*" onchange="handleImageFile(this)">

                <div class="controls">
                    <div class="control-group">
                        <h3>ì••ì¶• ì„¤ì •</h3>
                        <div class="form-group">
                            <label for="image-target-size">ëª©í‘œ ìš©ëŸ‰ (KB)</label>
                            <input type="number" id="image-target-size" placeholder="ì˜ˆ: 500" min="10" max="10240">
                        </div>
                    </div>
                </div>

                <button class="process-btn" onclick="processImage()" disabled>ì´ë¯¸ì§€ ì••ì¶•í•˜ê¸°</button>
            </div>

            <!-- ì˜ìƒ ì••ì¶• íƒ­ -->
            <div id="video-tab" class="tab-content">
                <div class="upload-area" onclick="document.getElementById('video-file').click()">
                    <div class="upload-icon">ğŸ¬</div>
                    <div class="upload-text">ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">MP4, WebM, AVI, MOV, MKV ì§€ì› (ìµœëŒ€ 500MB)</div>
                </div>
                <input type="file" id="video-file" class="file-input" accept="video/*" onchange="handleVideoFile(this)">

                <div class="controls">
                    <div class="control-group">
                        <h3>ì²˜ë¦¬ ë°©ì‹</h3>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="compress-mode" name="video-mode" value="compress" checked>
                                <label for="compress-mode">ì••ì¶•</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="split-mode" name="video-mode" value="split">
                                <label for="split-mode">ë¶„í• </label>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>ìš©ëŸ‰ ì„¤ì •</h3>
                        <div class="form-group">
                            <label for="video-target-size">ëª©í‘œ ìš©ëŸ‰ (KB)</label>
                            <input type="number" id="video-target-size" placeholder="ì˜ˆ: 102400 (100MB)" min="1" max="512000">
                        </div>
                    </div>
                </div>

                <button class="process-btn" onclick="processVideo()" disabled>ì˜ìƒ ì²˜ë¦¬í•˜ê¸°</button>
            </div>

            <!-- WebM ë¶„í•  íƒ­ -->
            <div id="webm-tab" class="tab-content">
                <div class="upload-area" onclick="document.getElementById('webm-file').click()">
                    <div class="upload-icon">ğŸ¥</div>
                    <div class="upload-text">WebM íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">í™”ì§ˆ ë³€ê²½ ì§€ì ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ë¶„í• í•©ë‹ˆë‹¤</div>
                </div>
                <input type="file" id="webm-file" class="file-input" accept=".webm" onchange="handleWebMFile(this)">

                <div class="controls">
                    <div class="control-group">
                        <h3>ë¶„í•  ì„¤ì •</h3>
                        <div class="form-group">
                            <label for="webm-target-size">ê° ë¶„í•  íŒŒì¼ ìµœëŒ€ ìš©ëŸ‰ (KB)</label>
                            <input type="number" id="webm-target-size" placeholder="ì˜ˆ: 51200 (50MB)" min="1" max="512000">
                        </div>
                    </div>
                </div>

                <button class="process-btn" onclick="processWebM()" disabled>WebM ë¶„í• í•˜ê¸°</button>
            </div>

            <!-- ì§„í–‰ ìƒí™© -->
            <div class="progress-container" id="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">ì²˜ë¦¬ ì¤‘...</div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div class="result-container" id="result-container">
                <div class="result-header">
                    <div class="result-title" id="result-title">ì²˜ë¦¬ ê²°ê³¼</div>
                    <div class="result-status" id="result-status">ì„±ê³µ</div>
                </div>
                <div class="result-info" id="result-info"></div>
                <div class="download-section" id="download-section"></div>
                <div class="parts-list" id="parts-list"></div>
            </div>
        </div>
    </div>

    <script>
        let currentFile = null;
        let currentFileType = null;

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // ê²°ê³¼ ìˆ¨ê¸°ê¸°
            hideResult();
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            resetFileInput();
        }

        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
        function handleImageFile(input) {
            if (input.files[0]) {
                const file = input.files[0];
                if (validateFile(file, 'image')) {
                    currentFile = file;
                    currentFileType = 'image';
                    document.querySelector('#image-tab .process-btn').disabled = false;
                    showFileInfo(currentFile);
                }
            }
        }

        function handleVideoFile(input) {
            if (input.files[0]) {
                const file = input.files[0];
                if (validateFile(file, 'video')) {
                    currentFile = file;
                    currentFileType = 'video';
                    document.querySelector('#video-tab .process-btn').disabled = false;
                    showFileInfo(currentFile);
                }
            }
        }

        function handleWebMFile(input) {
            if (input.files[0]) {
                const file = input.files[0];
                if (validateFile(file, 'webm')) {
                    currentFile = file;
                    currentFileType = 'webm';
                    document.querySelector('#webm-tab .process-btn').disabled = false;
                    showFileInfo(currentFile);
                }
            }
        }

        // íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateFile(file, type) {
            const maxSize = 500 * 1024 * 1024; // 500MB
            const fileSizeMB = Math.round(file.size / (1024 * 1024));
            
            // íŒŒì¼ í¬ê¸° ê²€ì‚¬
            if (file.size > maxSize) {
                alert(`íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. ìµœëŒ€ 500MBê¹Œì§€ ì§€ì›ë©ë‹ˆë‹¤. (í˜„ì¬: ${fileSizeMB}MB)`);
                return false;
            }
            
            // íŒŒì¼ í˜•ì‹ ê²€ì‚¬
            if (type === 'image') {
                if (!file.type.startsWith('image/')) {
                    alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
            } else if (type === 'video') {
                if (!file.type.startsWith('video/')) {
                    alert('ì˜ìƒ íŒŒì¼ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
            } else if (type === 'webm') {
                if (!file.name.toLowerCase().endsWith('.webm')) {
                    alert('WebM íŒŒì¼ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
            }
            
            return true;
        }

        // íŒŒì¼ ì •ë³´ í‘œì‹œ
        function showFileInfo(file) {
            const sizeKB = (file.size / 1024).toFixed(2);
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            
            console.log(`ì„ íƒëœ íŒŒì¼: ${file.name} (${sizeKB}KB / ${sizeMB}MB)`);
            
            // íŒŒì¼ ì •ë³´ë¥¼ í™”ë©´ì— í‘œì‹œ
            const activeTab = document.querySelector('.tab-content.active');
            const uploadArea = activeTab.querySelector('.upload-area');
            
            // í¬ê¸°ì— ë”°ë¼ ì ì ˆí•œ ë‹¨ìœ„ë¡œ í‘œì‹œ
            let displaySize;
            if (parseFloat(sizeMB) >= 1) {
                displaySize = `${sizeMB} MB`;
            } else {
                displaySize = `${sizeKB} KB`;
            }
            
            uploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ì„ íƒëœ íŒŒì¼: ${file.name}</div>
                <div class="upload-subtext">í¬ê¸°: ${displaySize} | í˜•ì‹: ${file.type || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                <div class="upload-subtext" style="margin-top: 10px; color: #667eea; cursor: pointer;" onclick="resetFileInput()">ë‹¤ë¥¸ íŒŒì¼ ì„ íƒ</div>
            `;
        }

        // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
        function resetFileInput() {
            const activeTab = document.querySelector('.tab-content.active');
            const fileInput = activeTab.querySelector('input[type="file"]');
            const uploadArea = activeTab.querySelector('.upload-area');
            
            fileInput.value = '';
            currentFile = null;
            
            // ì—…ë¡œë“œ ì˜ì—­ ì›ë˜ëŒ€ë¡œ ë³µì›
            if (activeTab.id === 'image-tab') {
                uploadArea.innerHTML = `
                    <div class="upload-icon">ğŸ“·</div>
                    <div class="upload-text">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">JPG, PNG, WebP, GIF ì§€ì› (ìµœëŒ€ 500MB)</div>
                `;
            } else if (activeTab.id === 'video-tab') {
                uploadArea.innerHTML = `
                    <div class="upload-icon">ğŸ¬</div>
                    <div class="upload-text">ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">MP4, WebM, AVI, MOV, MKV ì§€ì› (ìµœëŒ€ 500MB)</div>
                `;
            } else if (activeTab.id === 'webm-tab') {
                uploadArea.innerHTML = `
                    <div class="upload-icon">ğŸ¥</div>
                    <div class="upload-text">WebM íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">í™”ì§ˆ ë³€ê²½ ì§€ì ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ë¶„í• í•©ë‹ˆë‹¤</div>
                `;
            }
            
            // ì²˜ë¦¬ ë²„íŠ¼ ë¹„í™œì„±í™”
            const processBtn = activeTab.querySelector('.process-btn');
            if (processBtn) {
                processBtn.disabled = true;
            }
        }

        // ì´ë¯¸ì§€ ì••ì¶•
        async function processImage() {
            const targetSize = document.getElementById('image-target-size').value;
            if (!targetSize || !currentFile) {
                alert('ëª©í‘œ ìš©ëŸ‰ì„ ì…ë ¥í•˜ê³  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            await processFile('/api/compress-image', { targetSizeKB: targetSize });
        }

        // ì˜ìƒ ì²˜ë¦¬
        async function processVideo() {
            const targetSize = document.getElementById('video-target-size').value;
            const mode = document.querySelector('input[name="video-mode"]:checked').value;
            
            if (!targetSize || !currentFile) {
                alert('ëª©í‘œ ìš©ëŸ‰ì„ ì…ë ¥í•˜ê³  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            await processFile('/api/compress-video', { 
                targetSizeKB: targetSize, 
                compressionMode: mode 
            });
        }

        // WebM ë¶„í• 
        async function processWebM() {
            const targetSize = document.getElementById('webm-target-size').value;
            if (!targetSize || !currentFile) {
                alert('ëª©í‘œ ìš©ëŸ‰ì„ ì…ë ¥í•˜ê³  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            await processFile('/api/split-webm', { targetSizeKB: targetSize });
        }

        // íŒŒì¼ ì²˜ë¦¬ ê³µí†µ í•¨ìˆ˜
        async function processFile(endpoint, data) {
            showProgress();
            
            const formData = new FormData();
            
            // íŒŒì¼ í•„ë“œëª…ì„ ì—”ë“œí¬ì¸íŠ¸ì— ë§ê²Œ ì„¤ì •
            if (endpoint.includes('image')) {
                formData.append('image', currentFile);
            } else if (endpoint.includes('video') || endpoint.includes('webm')) {
                formData.append('video', currentFile);
            } else {
                formData.append('file', currentFile);
            }
            
            // ë°ì´í„° ì¶”ê°€
            Object.keys(data).forEach(key => {
                formData.append(key, data[key]);
            });

            // Base64 ì¶œë ¥ ì˜µì…˜ ì¶”ê°€
            if (document.getElementById('return-base64').checked) {
                formData.append('returnBase64', 'true');
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(result, 'success');
                } else {
                    showResult(result, 'error');
                }
            } catch (error) {
                console.error('ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                let errorMessage = 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('413')) {
                    errorMessage = 'íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 500MB)';
                } else if (error.message.includes('429')) {
                    errorMessage = 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                
                showResult({ error: errorMessage }, 'error');
            } finally {
                hideProgress();
            }
        }

        // ì§„í–‰ ìƒí™© í‘œì‹œ
        function showProgress() {
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('result-container').style.display = 'none';
            
            // ëª¨ë“  ì²˜ë¦¬ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.process-btn').forEach(btn => btn.disabled = true);
        }

        // ì§„í–‰ ìƒí™© ìˆ¨ê¸°ê¸°
        function hideProgress() {
            document.getElementById('progress-container').style.display = 'none';
            
            // í˜„ì¬ íƒ­ì˜ ì²˜ë¦¬ ë²„íŠ¼ í™œì„±í™”
            const activeTab = document.querySelector('.tab-content.active');
            const processBtn = activeTab.querySelector('.process-btn');
            if (processBtn && currentFile) {
                processBtn.disabled = false;
            }
        }

        // í¬ê¸° í¬ë§·íŒ… í•¨ìˆ˜ (ëª¨ë‘ KBë¡œ í†µì¼)
        function formatSize(sizeKB) {
            if (!sizeKB && sizeKB !== 0) return 'N/A';
            
            const kb = parseFloat(sizeKB);
            
            // GB ë‹¨ìœ„ (1048576 KB = 1024 MB = 1 GB)
            if (kb >= 1048576) {
                return `${(kb / 1048576).toFixed(2)} GB`;
            }
            // MB ë‹¨ìœ„ (1024 KB = 1 MB)
            else if (kb >= 1024) {
                return `${(kb / 1024).toFixed(2)} MB`;
            }
            // KB ë‹¨ìœ„
            else {
                return `${kb.toFixed(2)} KB`;
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(result, status) {
            const container = document.getElementById('result-container');
            const title = document.getElementById('result-title');
            const statusEl = document.getElementById('result-status');
            const infoEl = document.getElementById('result-info');
            const downloadEl = document.getElementById('download-section');
            const partsEl = document.getElementById('parts-list');

            container.style.display = 'block';
            
            if (status === 'success') {
                title.textContent = 'ì²˜ë¦¬ ì™„ë£Œ';
                statusEl.textContent = 'ì„±ê³µ';
                statusEl.className = 'result-status success';
                
                // ê¸°ë³¸ ì •ë³´ í‘œì‹œ (ëª¨ë‘ KB ë‹¨ìœ„ë¡œ í†µì¼)
                infoEl.innerHTML = `
                    <div class="info-item">
                        <div class="info-label">ì›ë³¸ í¬ê¸°</div>
                        <div class="info-value">${formatSize(result.originalSize)}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì²˜ë¦¬ í›„ í¬ê¸°</div>
                        <div class="info-value">${result.compressedSize ? formatSize(result.compressedSize) : (result.totalParts + 'ê°œ íŒŒì¼')}</div>
                    </div>
                    ${result.compressionRatio ? `
                    <div class="info-item">
                        <div class="info-label">ì••ì¶•ë¥ </div>
                        <div class="info-value">${parseFloat(result.compressionRatio).toFixed(1)}%</div>
                    </div>
                    ` : ''}
                `;
                
                // ë‹¤ìš´ë¡œë“œ ë§í¬
                if (result.base64) {
                    const isImage = result.base64.startsWith('data:image');
                    const isVideo = result.base64.startsWith('data:video');

                    downloadEl.innerHTML = `
                        <div class="base64-output">
                            <div class="info-label">Base64 ë°ì´í„° URI</div>
                            <textarea readonly>${result.base64.substring(0, 150)}...</textarea>
                            <div class="base64-actions">
                                <button onclick="copyToClipboard('${result.base64}')">ì „ì²´ ë³µì‚¬</button>
                            </div>
                            ${isImage ? `<div class="base64-preview"><img src="${result.base64}" alt="ì²˜ë¦¬ ê²°ê³¼ ì´ë¯¸ì§€"></div>` : ''}
                            ${isVideo ? `<div class="base64-preview"><video src="${result.base64}" controls></video></div>` : ''}
                        </div>
                    `;
                } else if (result.outputPath) {
                    downloadEl.innerHTML = `
                        <a href="${result.outputPath}" class="download-btn" download>ë‹¤ìš´ë¡œë“œ</a>
                    `;
                } else {
                    downloadEl.innerHTML = '';
                }
                
                // ë¶„í• ëœ íŒŒì¼ ëª©ë¡
                if (result.parts && result.parts.length > 0) {
                    partsEl.innerHTML = result.parts.map(part => `
                        <div class="part-item">
                            <div class="part-info">
                                <div class="part-title">íŒŒíŠ¸ ${part.partNumber}</div>
                                <div class="part-details">
                                    í¬ê¸°: ${formatSize(part.size)}
                                    ${part.duration ? `| ê¸¸ì´: ${Math.round(part.duration)}ì´ˆ` : ''}
                                    ${part.startTime !== undefined ? `| ì‹œì‘: ${Math.round(part.startTime)}ì´ˆ` : ''}
                                </div>
                                ${part.qualityChange ? `
                                    <div class="quality-change">
                                        í™”ì§ˆ ë³€ê²½ ê°ì§€: ${part.qualityChange.type} (${part.qualityChange.from} â†’ ${part.qualityChange.to})
                                    </div>
                                ` : ''}
                                ${part.base64 ? `
                                    <div class="base64-output" style="margin-top: 10px;">
                                        <div class="base64-actions">
                                            <button onclick="copyToClipboard('${part.base64}')">Base64 ë³µì‚¬</button>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            ${!part.base64 ? `<a href="${part.outputPath}" class="download-btn" download>ë‹¤ìš´ë¡œë“œ</a>` : ''}
                        </div>
                    `).join('');
                } else {
                    partsEl.innerHTML = '';
                }
                
            } else {
                title.textContent = 'ì²˜ë¦¬ ì‹¤íŒ¨';
                statusEl.textContent = 'ì˜¤ë¥˜';
                statusEl.className = 'result-status error';
                
                infoEl.innerHTML = `
                    <div class="info-item">
                        <div class="info-label">ì˜¤ë¥˜ ë©”ì‹œì§€</div>
                        <div class="info-value">${result.error || result.message}</div>
                    </div>
                `;
                
                downloadEl.innerHTML = '';
                partsEl.innerHTML = '';
            }
        }

        // ê²°ê³¼ ìˆ¨ê¸°ê¸°
        function hideResult() {
            document.getElementById('result-container').style.display = 'none';
        }

        // í´ë¦½ë³´ë“œì— ë³µì‚¬
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Base64 ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }, (err) => {
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì˜¤ë¥˜:', err);
            });
        }

        // API ìƒíƒœ í™•ì¸
        async function checkApiStatus() {
            try {
                const response = await fetch('/');
                const result = await response.json();
                
                const statusEl = document.getElementById('status-text');
                const indicatorEl = document.querySelector('.status-indicator');
                
                if (result.status === 'online') {
                    statusEl.textContent = `API ì˜¨ë¼ì¸ (v${result.version})`;
                    indicatorEl.className = 'status-indicator status-online';
                } else {
                    statusEl.textContent = 'API ì˜¤í”„ë¼ì¸';
                    indicatorEl.className = 'status-indicator status-offline';
                }
            } catch (error) {
                const statusEl = document.getElementById('status-text');
                const indicatorEl = document.querySelector('.status-indicator');
                statusEl.textContent = 'API ì—°ê²° ì‹¤íŒ¨';
                indicatorEl.className = 'status-indicator status-offline';
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            // API ìƒíƒœ í™•ì¸
            checkApiStatus();
            
            const uploadAreas = document.querySelectorAll('.upload-area');
            
            uploadAreas.forEach(area => {
                area.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    area.classList.add('dragover');
                });
                
                area.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    area.classList.remove('dragover');
                });
                
                area.addEventListener('drop', function(e) {
                    e.preventDefault();
                    area.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        const activeTab = document.querySelector('.tab-content.active');
                        
                        if (activeTab.id === 'image-tab') {
                            document.getElementById('image-file').files = files;
                            handleImageFile(document.getElementById('image-file'));
                        } else if (activeTab.id === 'video-tab') {
                            document.getElementById('video-file').files = files;
                            handleVideoFile(document.getElementById('video-file'));
                        } else if (activeTab.id === 'webm-tab') {
                            document.getElementById('webm-file').files = files;
                            handleWebMFile(document.getElementById('webm-file'));
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
